jobs:
- job: TestInstallReleaseScriptPwsh
  displayName: 'Test installcredproviderrelease.ps1 (PowerShell 7+)'
  pool:
    vmImage: windows-latest
  steps:
  - checkout: self
  - task: PowerShell@2
    displayName: Run tests (pwsh)
    inputs:
      targetType: 'inline'
      pwsh: true
      script: |
        ./helpers/test-installcredproviderrelease.ps1

- job: TestInstallReleaseScriptPS5
  displayName: 'Test installcredproviderrelease.ps1 (PowerShell 5.1)'
  pool:
    vmImage: windows-latest
  steps:
  - checkout: self
  - task: PowerShell@2
    displayName: Run tests (PowerShell 5.1)
    inputs:
      targetType: 'inline'
      pwsh: false
      script: |
        ./helpers/test-installcredproviderrelease.ps1

- job: TestInstallReleaseScriptLinux
  displayName: 'Test installcredproviderrelease.ps1 (Linux)'
  pool:
    vmImage: ubuntu-latest
  steps:
  - checkout: self
  - task: PowerShell@2
    displayName: Run tests (pwsh on Linux)
    inputs:
      targetType: 'inline'
      pwsh: true
      script: |
        ./helpers/test-installcredproviderrelease.ps1

- job: TestInstallReleaseScriptMacOS
  displayName: 'Test installcredproviderrelease.ps1 (macOS)'
  pool:
    vmImage: macOS-latest
  steps:
  - checkout: self
  - task: PowerShell@2
    displayName: Run tests (pwsh on macOS)
    inputs:
      targetType: 'inline'
      pwsh: true
      script: |
        ./helpers/test-installcredproviderrelease.ps1

- job: WindowsReleaseInstallDefault
  pool:
    vmImage: windows-latest
  steps:
  - template: validate-install-release-script-powershell.yml@self
    parameters:
      repo: self
      scriptInputs: ''
      expectedCredentialProviderVersion: 'Microsoft.win-x64.NuGet.CredentialProvider'
      releaseVersion: 'latest'

- job: WindowsReleaseInstallNet8
  pool:
    vmImage: windows-latest
  steps:
  - template: validate-install-release-script-powershell.yml@self
    parameters:
      repo: self
      scriptInputs: '-InstallNet8'
      expectedCredentialProviderVersion: 'Microsoft.win-x64.NuGet.CredentialProvider'
      releaseVersion: 'latest'

- job: WindowsReleaseInstallNet8winx64
  pool:
    vmImage: windows-latest
  steps:
  - template: validate-install-release-script-powershell.yml@self
    parameters:
      repo: self
      scriptInputs: '-InstallNet8 -RuntimeIdentifier win-x64'
      expectedCredentialProviderVersion: 'Microsoft.win-x64.NuGet.CredentialProvider'
      releaseVersion: 'latest'

- job: WindowsReleaseInstallNet8winx64NoParams
  pool:
    vmImage: windows-latest
  steps:
  - template: validate-install-release-script-powershell.yml@self
    parameters:
      repo: self
      scriptInputs: '-RuntimeIdentifier win-x64'
      expectedCredentialProviderVersion: 'Microsoft.win-x64.NuGet.CredentialProvider'
      releaseVersion: 'latest'

- job: WindowsReleaseInstallNetfxDefault
  pool:
    vmImage: windows-latest
  steps:
  - template: validate-install-release-script-powershell.yml@self
    parameters:
      repo: self
      scriptInputs: '-AddNetfx'
      expectedCredentialProviderVersion: 'Microsoft.NetFx48.NuGet.CredentialProvider'
      releaseVersion: 'latest'

- job: LinuxReleaseInstallDefault
  pool:
    vmImage: ubuntu-latest
  steps:
  - template: validate-install-release-script-bash.yml@self
    parameters:
      repo: self
      scriptEnvVariables: ''
      expectedCredentialProviderVersion: 'Microsoft.linux-x64.NuGet.CredentialProvider'
      releaseVersion: 'latest'

- job: LinuxReleaseInstallNet8
  pool:
    vmImage: ubuntu-latest
  steps:
  - template: validate-install-release-script-bash.yml@self
    parameters:
      repo: self
      scriptEnvVariables: |
        export USE_NET6_ARTIFACTS_CREDENTIAL_PROVIDER=false
        export USE_NET8_ARTIFACTS_CREDENTIAL_PROVIDER=true
      expectedCredentialProviderVersion: 'Microsoft.linux-x64.NuGet.CredentialProvider'
      releaseVersion: 'latest'

- job: LinuxReleaseInstallNet8Net6Param
  pool:
    vmImage: ubuntu-latest
  steps:
  - template: validate-install-release-script-bash.yml@self
    parameters:
      repo: self
      scriptEnvVariables: |
        export USE_NET6_ARTIFACTS_CREDENTIAL_PROVIDER=true
        export USE_NET8_ARTIFACTS_CREDENTIAL_PROVIDER=true
      expectedCredentialProviderVersion: 'Microsoft.linux-x64.NuGet.CredentialProvider'
      releaseVersion: 'latest'

- job: LinuxReleaseInstallNetFx
  pool:
    vmImage: ubuntu-latest
  steps:
  - template: validate-install-release-script-bash.yml@self
    parameters:
      repo: self
      scriptEnvVariables: |
        export USE_NET6_ARTIFACTS_CREDENTIAL_PROVIDER=false
        export USE_NET8_ARTIFACTS_CREDENTIAL_PROVIDER=false
      expectedCredentialProviderVersion: 'Microsoft.NetFx48.NuGet.CredentialProvider'
      releaseVersion: 'latest'

- job: LinuxReleaseInstallNet8linuxx64
  pool:
    vmImage: ubuntu-latest
  steps:
  - template: validate-install-release-script-bash.yml@self
    parameters:
      repo: self
      scriptEnvVariables: |
        export USE_NET6_ARTIFACTS_CREDENTIAL_PROVIDER=false
        export USE_NET8_ARTIFACTS_CREDENTIAL_PROVIDER=true
        export ARTIFACTS_CREDENTIAL_PROVIDER_RID=linux-x64
      expectedCredentialProviderVersion: 'Microsoft.linux-x64.NuGet.CredentialProvider'
      releaseVersion: 'latest'

- job: LinuxReleaseInstallNet8linuxarm64
  pool:
    vmImage: ubuntu-latest
  steps:
  - template: validate-install-release-script-bash.yml@self
    parameters:
      repo: self
      scriptEnvVariables: |
        export USE_NET6_ARTIFACTS_CREDENTIAL_PROVIDER=false
        export USE_NET8_ARTIFACTS_CREDENTIAL_PROVIDER=true
        export ARTIFACTS_CREDENTIAL_PROVIDER_RID=linux-arm64
      expectedCredentialProviderVersion: 'Microsoft.linux-arm64.NuGet.CredentialProvider'
      releaseVersion: 'latest'

- job: macOSReleaseInstallNet8osxarm64
  pool:
    vmImage: macOS-latest
  steps:
  - template: validate-install-release-script-bash.yml@self
    parameters:
      repo: self
      scriptEnvVariables: |
        export USE_NET6_ARTIFACTS_CREDENTIAL_PROVIDER=false
        export USE_NET8_ARTIFACTS_CREDENTIAL_PROVIDER=true
        export ARTIFACTS_CREDENTIAL_PROVIDER_RID=osx-arm64
      expectedCredentialProviderVersion: 'Microsoft.osx-arm64.NuGet.CredentialProvider'
      releaseVersion: 'latest'

- job: macOSReleaseInstallNet8osxx64
  pool:
    vmImage: macOS-latest
  steps:
  - template: validate-install-release-script-bash.yml@self
    parameters:
      repo: self
      scriptEnvVariables: |
        export USE_NET6_ARTIFACTS_CREDENTIAL_PROVIDER=false
        export USE_NET8_ARTIFACTS_CREDENTIAL_PROVIDER=true
        export ARTIFACTS_CREDENTIAL_PROVIDER_RID=osx-x64
      expectedCredentialProviderVersion: 'Microsoft.osx-x64.NuGet.CredentialProvider'
      releaseVersion: 'latest'

- job: macOSReleaseInstallNet8osxx64NoParams
  pool:
    vmImage: macOS-latest
  steps:
  - template: validate-install-release-script-bash.yml@self
    parameters:
      repo: self
      scriptEnvVariables: |
        export ARTIFACTS_CREDENTIAL_PROVIDER_RID=osx-x64
      expectedCredentialProviderVersion: 'Microsoft.osx-x64.NuGet.CredentialProvider'
      releaseVersion: 'latest'

- job: macOSReleaseInstallNet8osxx64Net6Params
  pool:
    vmImage: macOS-latest
  steps:
  - template: validate-install-release-script-bash.yml@self
    parameters:
      repo: self
      scriptEnvVariables: |
        export USE_NET6_ARTIFACTS_CREDENTIAL_PROVIDER=true
        export ARTIFACTS_CREDENTIAL_PROVIDER_RID=osx-x64
      expectedCredentialProviderVersion: 'Microsoft.osx-x64.NuGet.CredentialProvider'
      releaseVersion: 'latest'

# Test with specific release version (using a common stable version 1.4.0)
- job: WindowsReleaseInstallVersionNoPrefix
  pool:
    vmImage: windows-latest
  steps:
  - template: validate-install-release-script-powershell.yml@self
    parameters:
      repo: self
      scriptInputs: '-InstallNet8'
      expectedCredentialProviderVersion: 'Microsoft.Net8.NuGet.CredentialProvider'
      releaseVersion: '1.4.0'

- job: WindowsReleaseInstallVersion
  pool:
    vmImage: windows-latest
  steps:
  - template: validate-install-release-script-powershell.yml@self
    parameters:
      repo: self
      scriptInputs: '-InstallNet8'
      expectedCredentialProviderVersion: 'Microsoft.Net8.NuGet.CredentialProvider'
      releaseVersion: 'v1.4.0'

- job: LinuxReleaseInstallVersion
  pool:
    vmImage: ubuntu-latest
  steps:
  - template: validate-install-release-script-bash.yml@self
    parameters:
      repo: self
      scriptEnvVariables: |
        export USE_NET6_ARTIFACTS_CREDENTIAL_PROVIDER=false
        export USE_NET8_ARTIFACTS_CREDENTIAL_PROVIDER=true
      expectedCredentialProviderVersion: 'Microsoft.Net8.NuGet.CredentialProvider'
      releaseVersion: 'v1.4.0'

# Shell (sh) validation jobs
- job: LinuxReleaseInstallDefaultSh
  pool:
    vmImage: ubuntu-latest
  steps:
  - template: validate-install-release-script-sh.yml@self
    parameters:
      repo: self
      scriptEnvVariables: ''
      expectedCredentialProviderVersion: 'Microsoft.linux-x64.NuGet.CredentialProvider'
      releaseVersion: 'latest'

- job: LinuxReleaseInstallNet8Sh
  pool:
    vmImage: ubuntu-latest
  steps:
  - template: validate-install-release-script-sh.yml@self
    parameters:
      repo: self
      scriptEnvVariables: |
        export USE_NET6_ARTIFACTS_CREDENTIAL_PROVIDER=false
        export USE_NET8_ARTIFACTS_CREDENTIAL_PROVIDER=true
      expectedCredentialProviderVersion: 'Microsoft.linux-x64.NuGet.CredentialProvider'
      releaseVersion: 'latest'

- job: LinuxReleaseInstallNet8Net6ParamSh
  pool:
    vmImage: ubuntu-latest
  steps:
  - template: validate-install-release-script-sh.yml@self
    parameters:
      repo: self
      scriptEnvVariables: |
        export USE_NET6_ARTIFACTS_CREDENTIAL_PROVIDER=true
        export USE_NET8_ARTIFACTS_CREDENTIAL_PROVIDER=true
      expectedCredentialProviderVersion: 'Microsoft.linux-x64.NuGet.CredentialProvider'
      releaseVersion: 'latest'

- job: LinuxReleaseInstallNetFxSh
  pool:
    vmImage: ubuntu-latest
  steps:
  - template: validate-install-release-script-sh.yml@self
    parameters:
      repo: self
      scriptEnvVariables: |
        export USE_NET6_ARTIFACTS_CREDENTIAL_PROVIDER=false
        export USE_NET8_ARTIFACTS_CREDENTIAL_PROVIDER=false
      expectedCredentialProviderVersion: 'Microsoft.NetFx48.NuGet.CredentialProvider'
      releaseVersion: 'latest'

- job: LinuxReleaseInstallNet8linuxx64Sh
  pool:
    vmImage: ubuntu-latest
  steps:
  - template: validate-install-release-script-sh.yml@self
    parameters:
      repo: self
      scriptEnvVariables: |
        export USE_NET6_ARTIFACTS_CREDENTIAL_PROVIDER=false
        export USE_NET8_ARTIFACTS_CREDENTIAL_PROVIDER=true
        export ARTIFACTS_CREDENTIAL_PROVIDER_RID=linux-x64
      expectedCredentialProviderVersion: 'Microsoft.linux-x64.NuGet.CredentialProvider'
      releaseVersion: 'latest'

- job: LinuxReleaseInstallNet8linuxarm64Sh
  pool:
    vmImage: ubuntu-latest
  steps:
  - template: validate-install-release-script-sh.yml@self
    parameters:
      repo: self
      scriptEnvVariables: |
        export USE_NET6_ARTIFACTS_CREDENTIAL_PROVIDER=false
        export USE_NET8_ARTIFACTS_CREDENTIAL_PROVIDER=true
        export ARTIFACTS_CREDENTIAL_PROVIDER_RID=linux-arm64
      expectedCredentialProviderVersion: 'Microsoft.linux-arm64.NuGet.CredentialProvider'
      releaseVersion: 'latest'

- job: macOSReleaseInstallDefaultSh
  pool:
    vmImage: macOS-latest
  steps:
  - template: validate-install-release-script-sh.yml@self
    parameters:
      repo: self
      scriptEnvVariables: ''
      expectedCredentialProviderVersion: 'Microsoft.osx-x64.NuGet.CredentialProvider'
      releaseVersion: 'latest'

- job: macOSReleaseInstallNet8osxx64Net6ParamsSh
  pool:
    vmImage: macOS-latest
  steps:
  - template: validate-install-release-script-sh.yml@self
    parameters:
      repo: self
      scriptEnvVariables: |
        export USE_NET6_ARTIFACTS_CREDENTIAL_PROVIDER=true
        export ARTIFACTS_CREDENTIAL_PROVIDER_RID=osx-x64
      expectedCredentialProviderVersion: 'Microsoft.osx-x64.NuGet.CredentialProvider'
      releaseVersion: 'latest'

- job: macOSReleaseInstallNet8osxx64NoParamsSh
  pool:
    vmImage: macOS-latest
  steps:
  - template: validate-install-release-script-sh.yml@self
    parameters:
      repo: self
      scriptEnvVariables: |
        export ARTIFACTS_CREDENTIAL_PROVIDER_RID=osx-x64
      expectedCredentialProviderVersion: 'Microsoft.osx-x64.NuGet.CredentialProvider'
      releaseVersion: 'latest'