parameters:
- name: repo
  type: string

jobs:
- job: validateLineEndings
  steps:
  - checkout: ${{ parameters.repo }}
  - bash: |
      if [grep $'\r' ./helpers/installcredprovider.sh]; then echo "CRLF line ending found" ; exit 1; fi
    workingDirectory: $(Build.SourcesDirectory)
- job: LinuxInstallDefault
  steps:
  - checkout: ${{ parameters.repo }}
  - bash: | 
      ./helpers/installcredprovider.sh -Force >> ./output.log
      cat ./output.log
      if [! grep "Microsoft.Net6.NuGet.CredentialProvider" ./output.log]; then echo "Not found"; exit 1; fi
      if [! -d "$HOME/.nuget/plugins/netcore/CredentialProvider.Microsoft"]; then echo "Not found"; exit 1; fi
    workingDirectory: $(Build.SourcesDirectory)
- job: LinuxInstallNet8
  steps:
  - checkout: ${{ parameters.repo }}
  - bash: | 
      export USE_NET6_ARTIFACTS_CREDENTIAL_PROVIDER=false
      export USE_NET8_ARTIFACTS_CREDENTIAL_PROVIDER=true

      ./helpers/installcredprovider.sh -Force >> ./output.log
      cat ./output.log
      if [! grep "Microsoft.Net8.NuGet.CredentialProvider" ./output.log]; then echo "wrong version"; exit 1; fi
      if [! -d "$HOME/.nuget/plugins/netcore/CredentialProvider.Microsoft"]; then echo "Not found"; exit 1; fi
    workingDirectory: $(Build.SourcesDirectory)
  